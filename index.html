<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.17" />

  <title>WRISH</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="WRISH" href="http://www.wrish.com/index.xml" />
  

  
  <link rel="stylesheet" href="http://www.wrish.com/css/atom-one-light.css">
  <script src="http://www.wrish.com/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://www.wrish.com/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/"><img src='/img/w.svg' height='65px' width='auto'>RISH</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/post/"><i class='fa fa-list fa-fw'></i>All Articles</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/tags/powershell/"><i class='fa fa-terminal fa-fw'></i>Powershell</a>
      
        </li>
      
    </ul>
  </div>
  

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://www.wrish.com/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
    </li>
    

    

    

	
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://social.technet.microsoft.com/profile/Shane%20Wright" target="_blank"><i class="fa fa-windows fa-fw"></i>Technet</a>
    </li>
    
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/neossian" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/1111059/neossian" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

  </ul>
</div>

  
<div>
  <div class="small-print">
    <ul class="pure-menu-list">
		
		<li>
			Language:<a href="http://www.wrish.com/fr/">fr</a>
		</li>
		
	</ul>	
  </div>
</div>

  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>


  </div>


  <div id="main">


<div class="header">
  <h1>WRISH</h1>
  <h2>A new corner</h2>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/assign-ems-licenses/">Assign EMS licenses to all licensed users</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>13  Feb 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">Powershell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/office365">Office365</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/intune">Intune</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/azure">Azure</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/conditionalaccess">ConditionalAccess</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  Azure conditional access provides amazingly flexible control over access to Office 365 resources and services based on location/user group membership/device etc. Leveraging it to block access generally requires EMS (Enterprise Mobility + Security) licenses for all users. This short script will assign EMS licenses to all users in your tenant who are licensed but do not have EMS yet.
#Script to add EMS Licenses to all licensed users $VerbosePreference = continue $SKU = get-msolaccountSKU | ?
  </p>

  
  <footer>
    <a href="/post/assign-ems-licenses/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/cleanup-user-profiles/">User Profile Cleanup</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>23  Jan 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">Powershell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/windowsserver">WindowsServer</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  Download Cleanup-UserProfiles.ps1
Big environments get messy, lots of users, lots of admins, lots of logging in here and there.
Profiles accumulate, C drive starts to get full, oh the humanity! Fear not humble Admin, on our adventures today we discover how to remove old user profiles with naught but the flick of a WMI method.
The meat and bonse of this function is getting user profiles and deleting them:
$userprofiles = Get-WmiObject -Class Win32_UserProfile $userprofiles[$whichOne].
  </p>

  
  <footer>
    <a href="/post/cleanup-user-profiles/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/paste-me-an-array/">Paste an array into a variable</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>19  Jan 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">Powershell</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  You&rsquo;ve got a list of values, you want that in an array.
You could copy it to a file, and import it. You could dump it as a string and split it into an array.. or you could Create-ArrayFromPastedText.
function Create-ArrayFromPastedText ($returnvalue = &quot;&quot;) { $result = @() while ($true) { $value = read-host if ($value -eq $returnvalue){ return $result } else { $result += $value } } }  You can use it like this
  </p>

  
  <footer>
    <a href="/post/paste-me-an-array/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/check-adfs-certificates-with-office365-configuration/">Check if Office 365 has Your Updated ADFS Certificates</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>15  Jan 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">Powershell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/adfs">ADFS</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  Download it here https://gallery.technet.microsoft.com/Check-and-Update-ADFS-3f27ee5e
This script has probably lived its useful life, but I&rsquo;m sharing it anyway, because.. well why not!
When you want to quickly check to see if your published federation metadata (containing your ADFS token signing certificates) exists on Office 365 you can use Get-MsolFederationProperty that&rsquo;s great if you have one domain.. but what if you have 25 or 50.
Create a profile on your ADFS servers
  </p>

  
  <footer>
    <a href="/post/check-adfs-certificates-with-office365-configuration/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/switch-ms-pki-back-to-sha1/">Generate an SHA-1 signed certificate after cutover to SHA-2</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>4  Jan 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/pki">PKI</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  You&rsquo;ve finally made the switch on your Microsoft AD CS PKI infrastructure to SHA2 (SHA256)&hellip; but there is always one.
One outlier application that won&rsquo;t accept an SHA-2 certificate and needs an SHA1 certificate to keep chugging for 1 more year.
Don&rsquo;t worry, you can switch your Active Directory Certificate Services PKI infrastructure back to SHA-1 for a little bit.
certutil -setreg ca\csp\CNGHashAlgorithm SHA1 restart-service certsrv  Now issue your certificate, and switch back.
  </p>

  
  <footer>
    <a href="/post/switch-ms-pki-back-to-sha1/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/straightforward-guide-to-hosting-for-free-with-github-pages-on-windows/">Hosting for free with GitHub Pages using Windows (with custom domain)</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>29  Dec 2016</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/hosting">Hosting</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  I am unashamedly cheap. Here is how to host your personal website for no cost on github pages running on a windows platform.
Install a GIT client There are lots - I chose the one that came up first in a Google search and haven&rsquo;t tried any others. Download Git For Windows Run Git-2.xx.x-64-bit.exe that you just downloaded and install setting the following options
 Use Git from the Windows Command Prompt (default) Checkout as-is, commit as-is (not default) Everything else default  Choosing the second item just means you will see less verbose output if you are using a Windows only environment.
  </p>

  
  <footer>
    <a href="/post/straightforward-guide-to-hosting-for-free-with-github-pages-on-windows/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/convert-between-immutableid-and-ad-object/">Office 365 - Convert between Immutable ID and AD Object </a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>22  Dec 2016</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/azuread">AzureAD</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/activedirectory">ActiveDirectory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/office365">Office365</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  <p>Two quick scripts to convert between ImmutableIDs and AD Objects with pipeline capability.
</p>
  </p>

  
  <footer>
    <a href="/post/convert-between-immutableid-and-ad-object/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/list-all-nested-memberships/">List all of a users group memberships</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>19  Dec 2016</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/activedirectory">ActiveDirectory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/powershell">Powershell</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  Download the script here
Auditing user access is hard, usually you audit from resource out - eg, finding all Domain Admins, or finding all users with full acecss to SecretShare$ share on SecretServer01. But occasionally want to audit from user out.. this is hard.. even impossible (if you have a very big environment). Lets talk about the first step Enumerating Nested Groups.
Token Groups Each user has a constructed attribute called tokengroups that returns a list of all transitive group memberships.
  </p>

  
  <footer>
    <a href="/post/list-all-nested-memberships/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/clone-ou-structure-to-new-domain/">Clone OU Structure to New Domain</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>16  Dec 2016</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/activedirectory">ActiveDirectory</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  <p>A quick, semi-powershell way to clone an OU structure from a source domain to a destination domain is to use the <code>ldifde</code> tool and then just modify the output.

To generate the Output file <code>Oustructure-cleaned.ldif</code> we use ldifde to export all OUs and then remove the domain name (this is not necessary but helps later).</p>
  </p>

  
  <footer>
    <a href="/post/clone-ou-structure-to-new-domain/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/cannot-retrieve-single-sign-on-status-aadconnect/">Azure AD Connect - Cannot Retrieve Single Sign On Status</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>8  Dec 2016</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/azuread">AzureAD</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/aadconnect">AADConnect</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  If you landed here, then you are very unlucky. You downloaded AADConnect version 1.1.370.0 with it&rsquo;s known issue. You don&rsquo;t have port 9090 open externally, so you don&rsquo;t get an undocumented error Cannot retrieve single sign on status. Learn more.
But do not fear. Just go and download the latest version.
  </p>

  
</article>

  

  


<nav class="pagination" role="pagination">
  
  <i class="fa fa-chevron-left"></i>
  
  <span>&nbsp;1 / 2&nbsp;</span>
  
  <a href="/page/2/"><i class="fa fa-chevron-right"></i></a>
  
</nav>



</div>

</div>
</div>
<script src="http://www.wrish.com/js/ui.js"></script>



</body>
</html>

