<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.46" />

  <title>WRISH</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="WRISH" href="http://www.wrish.com/index.xml" />
  

  
  <link rel="stylesheet" href="http://www.wrish.com/css/atom-one-light.css">
  <script src="http://www.wrish.com/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://www.wrish.com/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/"><img src='/img/w.svg' height='65px' width='auto'>RISH</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/post/"><i class='fa fa-list fa-fw'></i>All Articles</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/tags/powershell/"><i class='fa fa-terminal fa-fw'></i>Powershell</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://www.wrish.com/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>
  

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://www.wrish.com/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
    </li>
    

    

    

	
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://social.technet.microsoft.com/profile/Shane%20Wright" target="_blank"><i class="fa fa-windows fa-fw"></i>Technet</a>
    </li>
    
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/neossian" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/1111059/neossian" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

  </ul>
</div>

  
<div>
  <div class="pure-menu-center">
    <p>
				
			Language:<a href="http://www.wrish.com/fr/">fr</a> 		
			</p>
				
  </div>
</div>

  
  <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>	
  </div>
  
</div>


  </div>


  <div id="main">


<div class="header">
  <h1>WRISH</h1>
  <h2>A new corner</h2>
</div>

<div class="content">
  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/isolate-dc-pt10-reset-krbtgt-password-twice/">Isolate a DC - Part 10: Reset KrbTGT password twice</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2  Aug 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/active-directory">Active Directory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/forestrecovery">ForestRecovery</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  This is Part 10 of a series on Active Directory Forest recovery; a new password for your domain.
Rest KrbTGT password twice And finally, just in case someone still has a ticket lying around waiting to be used on your restored domain, sort that right out and update your KrbTGT password.
function Reset-KrbtgtPasswordTwice{ [CmdletBinding( SupportsShouldProcess = $true, ConfirmImpact = 'High')]param() $targetPassword = (ConvertTo-SecureString &quot;!7Dm$(get-random -minimum 10000000000000000 -maximum 1000000000000000000)$(get-random -minimum 10000000000000000 -maximum 1000000000000000000)#*&amp;&quot; -AsPlainText -Force) Write-Warning &quot;Resetting the KRBTGT password twice without allowing replication of the update may result in Domain Controllers that cannot replicate if they have temporarily lost connectivity.
  </p>

  
  <footer>
    <a href="/post/isolate-dc-pt10-reset-krbtgt-password-twice/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/isolate-dc-pt9-reset-intraforest-trust-passwords/">Isolate a DC - Part 9: Reset Intraforest trust passwords</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>12  Jul 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/active-directory">Active Directory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/forestrecovery">ForestRecovery</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  This is Part 9 of a series on Active Directory Forest recovery; trust no-one, or at least no peer domains.
Reset Intraforest trust passwords To avoid accidentally permitting interforest authentication with a Domain Controller that hasn&rsquo;t been restored yet we need to reset the Intra-Forest trust passwords to a common value on both sides. This way the restored domains will all talk with the same hash. Update the trust shared secret to something actually secret before running this command.
  </p>

  
  <footer>
    <a href="/post/isolate-dc-pt9-reset-intraforest-trust-passwords/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/isolate-dc-pt8-metadata-cleanup-all-other-dcs/">Isolate a DC - Part 8: Metadata cleanup all other DCs</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>20  Jun 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/active-directory">Active Directory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/forestrecovery">ForestRecovery</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  This is Part 8 of a series on Active Directory Forest recovery; make your DC lonely.
Metadata Cleanup all other DCs Its not recovered until all the DCs are alive, but first, you have to kill them off with Metadata cleanup. Unfortunately the powershell commands won&rsquo;t just delete a Domain Controller for you. So its up to NTDSUTIL automation to do the work again. You will need to run these in the Console host, not the PowerShell ISE.
  </p>

  
  <footer>
    <a href="/post/isolate-dc-pt8-metadata-cleanup-all-other-dcs/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/quickly-get-exchange-online-ips/">Powershell get Exchange Online IP addresses (for Firewall rules)</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>15  Jun 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/office365">Office365</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  <p>This one-liner will download the Office 365 IP list XML file and extract the IPv4 addresses for EOP and Exchange Online.
</p>
  </p>

  
  <footer>
    <a href="/post/quickly-get-exchange-online-ips/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/isolate-dc-pt7-seize-fsmo-roles/">Isolate a DC - Part 7: Seize all FSMO roles</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>12  Jun 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/active-directory">Active Directory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/forestrecovery">ForestRecovery</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  This is Part 7 of a series on Active Directory Forest recovery; you need to have your FSMOs under control.
Seize all FSMO roles The roles you seize will depend on if you are in a parent or child domain, the script below leverages NTDSUTIL to seize all roles for a forest root domain, and the Infrastructure Master, PDC and RID Master for Child domains. It also updates the FSMO owner attribute on your Application partitions (usually just Forest DNS zones and Domain DNS Zones)
  </p>

  
  <footer>
    <a href="/post/isolate-dc-pt7-seize-fsmo-roles/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/isolate-dc-pt6-raise-rid-pool/">Isolate a DC - Part 6: Raise RID pool</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>8  Jun 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/active-directory">Active Directory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/forestrecovery">ForestRecovery</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  This is Part 6 of a series on Active Directory Forest recovery, in today&rsquo;s exciting adventure we raise your RID pools by 100k and invalidate the current RID pool.
Raise RID Pools Allocation Resource Identifiers are handed out whenever you create objects you can assign security to, if you are knee deep in restoration of your forest, you&rsquo;ll want to make sure you don&rsquo;t accidentally grant access to something unexpectedly by re-using a list SID.
  </p>

  
  <footer>
    <a href="/post/isolate-dc-pt6-raise-rid-pool/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/powershell-oneliners/">PowerShell Oneliners</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>17  May 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">Powershell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/activedirectory">ActiveDirectory</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  <p>Just a list of useful oneliners for powershell server and AD management. Obviously some are not actually oneliners, but hey they&rsquo;re quick!
</p>
  </p>

  
  <footer>
    <a href="/post/powershell-oneliners/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/isolate-dc-pt5-disable-global-catalog/">Isolate a DC - Part 5: Disable Global Catalog</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>10  May 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/active-directory">Active Directory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/forestrecovery">ForestRecovery</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  This is Part 5 of a series on Active Directory Forest recovery which requires brining up restored DCs in their own network; bring them up with good manners and we all benefit.
Disable Global Catalog Now this step is strictly for Multi-Domain Forest recoveries. If your domains replicate cross domain boundaries, they&rsquo;ll start complaining about their USNs and nobody wants that. If you&rsquo;ve got yourself a nice simple single Domain environment, don&rsquo;t sweat it and move on your Global Catalog can merrily sing into the night air without anybody noticing.
  </p>

  
  <footer>
    <a href="/post/isolate-dc-pt5-disable-global-catalog/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/extracting-objects-from-text-certutil/">Extracting objects from commands that output text</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>30  Apr 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">Powershell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/pki">PKI</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  <p>There are many ways to throw a spanner. But if you really must throw it with powershell you&rsquo;ll want it to result in an object.</p>

<p>The versatility of objects can give much to legacy commands that still linger in the Windows administration world. This short tutorial should teach you to turn most legacy commands into one or more commandlets in some concise code.
</p>
  </p>

  
  <footer>
    <a href="/post/extracting-objects-from-text-certutil/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  
    <article>
  <header>
    <h2><a href="http://www.wrish.com/post/isolate-dc-pt4-reset-dsrm-password/">Isolate a DC - Part 4: Reset DSRM Password</a></h2>

    <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>29  Apr 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/powershell">PowerShell</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/active-directory">Active Directory</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/forestrecovery">ForestRecovery</a>
    
  </div>
  
  

</div>

  </header>

  <p>
  This is Part 4 of a multi part blog post on Domain Recovery and DC Isolation with the aid of Powershell in todays installment we learn that Directory Services Restore Mode (DSRM) is not actually needed to perform a full forest recovery.
Reset DSRM Password Another typically unnecessary step is getting your hands on your DSRM password - if you don&rsquo;t already have it. DSRM password is only used in DSRM mode, which you don&rsquo;t need for this fun exercise, but why not have it just in case!
  </p>

  
  <footer>
    <a href="/post/isolate-dc-pt4-reset-dsrm-password/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
  </footer>
  
</article>

  

  


<nav class="pagination" role="pagination">
  
  <i class="fa fa-chevron-left"></i>
  
  <span>&nbsp;1 / 4&nbsp;</span>
  
  <a href="/page/2/"><i class="fa fa-chevron-right"></i></a>
  
</nav>



</div>

</div>
</div>
<script src="http://www.wrish.com/js/ui.js"></script>



</body>
</html>

